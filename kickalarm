local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

-- [설정] 알림이 떠있는 시간 (5초)
local DISPLAY_DURATION = 5

-- GUI 초기화 함수 (컨테이너 생성)
local function getOrCreateGui()
	local player = Players.LocalPlayer
	if not player then return nil end
	
	local playerGui = player:WaitForChild("PlayerGui")
	local screenGui = playerGui:FindFirstChild("KickAlertSystem")
	
	if not screenGui then
		screenGui = Instance.new("ScreenGui")
		screenGui.Name = "KickAlertSystem"
		screenGui.ResetOnSpawn = false
		screenGui.Parent = playerGui
		
		-- [알림이 쌓일 투명 컨테이너]
		local container = Instance.new("Frame")
		container.Name = "Container"
		container.Parent = screenGui
		container.BackgroundTransparency = 1 -- 컨테이너 자체는 안 보임
		container.AnchorPoint = Vector2.new(0, 1) -- 기준점: 왼쪽 아래
		container.Position = UDim2.new(0, 20, 1, -20) -- 위치: 화면 왼쪽 아래 (여백 20)
		container.Size = UDim2.new(0, 400, 0, 600) -- 알림이 쌓일 공간 확보
		
		-- [자동 정렬 레이아웃] (밑에서 위로 쌓이게 함)
		local layout = Instance.new("UIListLayout")
		layout.Parent = container
		layout.SortOrder = Enum.SortOrder.LayoutOrder
		layout.VerticalAlignment = Enum.VerticalAlignment.Bottom -- 바닥부터 채움
		layout.Padding = UDim.new(0, 10) -- 알림 사이 간격 10px
	end
	
	return screenGui.Container
end

-- 1. 알림 UI 생성 함수
local function showNotification(targetName)
	local container = getOrCreateGui()
	if not container then return end
	
	-- [배경 프레임] (검은색 배경 + 빨간색 테두리)
	local bgFrame = Instance.new("Frame")
	bgFrame.Name = "AlertFrame"
	bgFrame.BackgroundColor3 = Color3.new(0, 0, 0) -- 배경: 검은색
	bgFrame.BorderColor3 = Color3.new(1, 0, 0)     -- 테두리: 빨간색
	bgFrame.BorderSizePixel = 3                    -- 테두리 두께
	bgFrame.BorderMode = Enum.BorderMode.Outline
	bgFrame.Size = UDim2.new(0, 350, 0, 50)        -- 크기 고정
	
	-- [텍스트 라벨] (하얀색 글씨 + 테두리 없음)
	local label = Instance.new("TextLabel")
	label.Parent = bgFrame
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = targetName .. " 님이 킥을 당했습니다"
	label.TextColor3 = Color3.new(1, 1, 1) -- 글자: 하얀색
	label.TextStrokeTransparency = 1       -- 글자 테두리 없음
	label.Font = Enum.Font.SourceSansBold
	label.TextSize = 25
	
	-- 컨테이너에 넣으면 자동으로 위치가 잡힘
	bgFrame.Parent = container
	
	-- 5초 뒤 삭제
	task.delay(DISPLAY_DURATION, function()
		if bgFrame then bgFrame:Destroy() end
	end)
end

-- 2. 가장 가까운 플레이어 찾는 함수
local function getClosestPlayer(position)
	local closestPlayer = nil
	local minDistance = math.huge 
	
	for _, p in pairs(Players:GetPlayers()) do
		if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
			local distance = (p.Character.HumanoidRootPart.Position - position).Magnitude
			if distance < minDistance then
				minDistance = distance
				closestPlayer = p
			end
		end
	end
	return closestPlayer
end

-- 3. Workspace 감시 로직
Workspace.ChildAdded:Connect(function(child)
	if child.Name == "BlackHoleKick" then
		task.wait() -- 로딩 대기
		
		local targetPos = nil
		
		if child:IsA("BasePart") then
			targetPos = child.Position
		elseif child:IsA("Model") then
			targetPos = child:GetPivot().Position
		end
		
		if targetPos then
			local victim = getClosestPlayer(targetPos)
			if victim then
				showNotification(victim.Name)
			else
				showNotification("누군가")
			end
		end
	end
end)

print("킥 알람 활설화 됨")
