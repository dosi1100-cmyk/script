-- Version: v1.2
-- Kick Notification Script (UI Removed & Text Resized & Stack Fix)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local plr = Players.LocalPlayer

-- 설정 변수
local ifKickThenT = true -- 기능 자동 활성화
local anchoredCache = {}

----------------------------------------------------------------------------------------- [ UI 설정 (스택형) ]

local guiName = "KickNotifySystem_Stack"
local existingGui = CoreGui:FindFirstChild(guiName)
if existingGui then
    existingGui:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = guiName
ScreenGui.ResetOnSpawn = false

-- 보안: CoreGui 또는 PlayerGui에 삽입
if syn and syn.protect_gui then
    syn.protect_gui(ScreenGui)
    ScreenGui.Parent = CoreGui
elseif gethui then
    ScreenGui.Parent = gethui()
else
    ScreenGui.Parent = CoreGui
end

-- 알림이 쌓일 투명 컨테이너 (왼쪽 전체 영역 사용, 아래 정렬)
local Container = Instance.new("Frame")
Container.Name = "NotifyContainer"
Container.Size = UDim2.new(0, 320, 1, -20) -- 너비 320, 높이는 화면 전체에서 하단 여백 20 뺌
Container.Position = UDim2.new(0, 20, 0, 0) -- 왼쪽 20 띄움
Container.BackgroundTransparency = 1
Container.Parent = ScreenGui

-- 자동 정렬 레이아웃 (아래에서 위로 쌓임)
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = Container
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom -- 바닥부터 채움
UIListLayout.Padding = UDim.new(0, 8) -- 알림 사이 간격 10

----------------------------------------------------------------------------------------- [ 커스텀 알림 UI ]

local function CustomNotify(title, content, duration)
    -- 메인 프레임 (검은색 배경, 빨간색 테두리)
    local frame = Instance.new("Frame")
    frame.Name = "NotifyFrame"
    frame.Size = UDim2.new(1, 0, 0, 65) -- 너비는 컨테이너에 맞춤
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0) -- 검은색 배경
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(255, 0, 0) -- 빨간색 테두리
    frame.Parent = Container -- 컨테이너에 넣어서 자동 정렬되게 함

    -- 제목 텍스트
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -10, 0, 25)
    titleLabel.Position = UDim2.new(0, 10, 0, 5)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 20
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = frame

    -- 내용 텍스트
    local contentLabel = Instance.new("TextLabel")
    contentLabel.Size = UDim2.new(1, -10, 0, 25)
    contentLabel.Position = UDim2.new(0, 10, 0, 32)
    contentLabel.BackgroundTransparency = 1
    contentLabel.Text = content
    contentLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
    contentLabel.TextSize = 17
    contentLabel.Font = Enum.Font.Gotham
    contentLabel.TextXAlignment = Enum.TextXAlignment.Left
    contentLabel.Parent = frame

    -- 등장 애니메이션 (선택 사항: 투명도 조절 등 가능하나 심플하게 유지)
    
    -- 지정된 시간 후 삭제 (프레임만 삭제하면 리스트 레이아웃이 자동으로 정렬함)
    task.delay(duration, function()
        if frame then frame:Destroy() end
    end)
end

----------------------------------------------------------------------------------------- [ 핵심 기능 로직 ]

local function ifKickThenF()
    -- 이미 접속해 있는 플레이어 캐시 초기화
    for _, otherPlr in ipairs(Players:GetPlayers()) do
        if otherPlr.Character then
            local hrp = otherPlr.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                anchoredCache[otherPlr] = hrp.Anchored == true
            end
        end
    end

    -- 플레이어 입장 시 추적 시작
    Players.PlayerAdded:Connect(function(newPlr)
        newPlr.CharacterAdded:Connect(function(char)
            local hrp = char:WaitForChild("HumanoidRootPart", 5)
            if hrp then
                anchoredCache[newPlr] = false
            end
        end)
    end)

    -- 플레이어 퇴장 시 강퇴 여부 확인 및 알림
    Players.PlayerRemoving:Connect(function(leavingPlr)
        if anchoredCache[leavingPlr] == true then
            local DISP = leavingPlr.DisplayName
            local NAP = leavingPlr.Name
            
            -- 커스텀 알림 호출
            CustomNotify("[ Kick Detected ]", "[" .. DISP .. "] ( @" .. NAP ..  ")", 7)
        end
        anchoredCache[leavingPlr] = nil
    end)

    -- 상태 감지 루프
    task.spawn(function()
        while ifKickThenT do
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Character then
                    local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        -- 플레이어가 앵커(Anchored) 상태인지 지속적으로 확인
                        anchoredCache[p] = hrp.Anchored == true
                    end
                end
            end
            task.wait(0.3) -- 부하 방지를 위한 딜레이
        end
    end)
end

-- 기능 실행
ifKickThenF()

-- 실행 확인용 알림
CustomNotify("Script Loaded", "Kick Notification Active v1.2", 3)
