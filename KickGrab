-- Version: v1.1
-- Kick Notification Script (UI Removed & Text Resized)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local plr = Players.LocalPlayer

-- 설정 변수
local ifKickThenT = true -- 기능 자동 활성화
local anchoredCache = {}

----------------------------------------------------------------------------------------- [ 커스텀 알림 UI ]
local function CustomNotify(title, content, duration)
    -- GUI 생성
    local guiName = "KickNotifyGUI_" .. math.random(1000,9999)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = guiName
    screenGui.ResetOnSpawn = false
    
    -- 보안을 위해 CoreGui에 넣거나, 불가능하면 PlayerGui에 넣음
    if syn and syn.protect_gui then
        syn.protect_gui(screenGui)
        screenGui.Parent = CoreGui
    elseif gethui then
        screenGui.Parent = gethui()
    else
        screenGui.Parent = CoreGui
    end

    -- 메인 프레임 (검은색 배경, 빨간색 테두리)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 320, 0, 65) -- 텍스트 크기에 맞춰 프레임도 약간 조정
    frame.Position = UDim2.new(0, 20, 1, -100) -- 왼쪽 하단 배치
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0) -- 검은색 배경
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(255, 0, 0) -- 빨간색 테두리
    frame.Parent = screenGui

    -- 제목 텍스트 (하얀색, 크기 증가 18 -> 20)
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -10, 0, 25)
    titleLabel.Position = UDim2.new(0, 10, 0, 5)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255) -- 하얀색 글자
    titleLabel.TextSize = 20 
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = frame

    -- 내용 텍스트 (이름 표시, 크기 증가 14 -> 17)
    local contentLabel = Instance.new("TextLabel")
    contentLabel.Size = UDim2.new(1, -10, 0, 25)
    contentLabel.Position = UDim2.new(0, 10, 0, 32)
    contentLabel.BackgroundTransparency = 1
    contentLabel.Text = content
    contentLabel.TextColor3 = Color3.fromRGB(230, 230, 230) -- 약간 어두운 하얀색 글자
    contentLabel.TextSize = 17
    contentLabel.Font = Enum.Font.Gotham
    contentLabel.TextXAlignment = Enum.TextXAlignment.Left
    contentLabel.Parent = frame

    -- 지정된 시간 후 삭제
    task.delay(duration, function()
        if screenGui then screenGui:Destroy() end
    end)
end

----------------------------------------------------------------------------------------- [ 핵심 기능 로직 ]

local function ifKickThenF()
    -- 이미 접속해 있는 플레이어 캐시 초기화
    for _, otherPlr in ipairs(Players:GetPlayers()) do
        if otherPlr.Character then
            local hrp = otherPlr.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                anchoredCache[otherPlr] = hrp.Anchored == true
            end
        end
    end

    -- 플레이어 입장 시 추적 시작
    Players.PlayerAdded:Connect(function(newPlr)
        newPlr.CharacterAdded:Connect(function(char)
            local hrp = char:WaitForChild("HumanoidRootPart", 5)
            if hrp then
                anchoredCache[newPlr] = false
            end
        end)
    end)

    -- 플레이어 퇴장 시 강퇴 여부 확인 및 알림
    Players.PlayerRemoving:Connect(function(leavingPlr)
        if anchoredCache[leavingPlr] == true then
            local DISP = leavingPlr.DisplayName
            local NAP = leavingPlr.Name
            
            -- 커스텀 알림 호출
            CustomNotify("[ Kick Detected ]", "[" .. DISP .. "] ( @" .. NAP ..  ")", 7)
        end
        anchoredCache[leavingPlr] = nil
    end)

    -- 상태 감지 루프
    task.spawn(function()
        while ifKickThenT do
            for _, p in ipairs(Players:GetPlayers()) do
                if p.Character then
                    local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        -- 플레이어가 앵커(Anchored) 상태인지 지속적으로 확인
                        anchoredCache[p] = hrp.Anchored == true
                    end
                end
            end
            task.wait(0.5) -- 부하 방지를 위한 딜레이
        end
    end)
end

-- 기능 실행
ifKickThenF()

-- 실행 확인용 알림
CustomNotify("Script Loaded", "Kick Notification Active (v1.1)", 3)
